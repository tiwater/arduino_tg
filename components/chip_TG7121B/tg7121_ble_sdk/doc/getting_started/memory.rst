.. _memory:

存储系统
============

Memory Map
-----------

+----------------+----------------------------+
| Runtime Memory | Range                      |
+================+============================+
| Flash          | 0x18000000 - 0x18080000    |
+----------------+----------------------------+
| SRAM           | 0x0000 - 0xC000            |
+----------------+----------------------------+


Flash
-------

+---------+---------------------+---------------------------+--------------------------------+-------------------------------+
|  No.    |    Section Name     | Start Offset              | End Offset                     | Size                          |
+=========+=====================+===========================+================================+===============================+
|   8     | OTA SETTINGS        | 0x7f000                   | 0x80000                        | 4KB                           |
+---------+---------------------+---------------------------+--------------------------------+-------------------------------+
|   7     | BLE PROTOCOL STACK  | __stack_lma__             | 0x7f000                        | About 205KB                   |
+---------+---------------------+---------------------------+--------------------------------+-------------------------------+
|   6     | BLE MESH STACK      | __mesh_stack_lma__        | __stack_lma__                  | About 120KB                   |
|         |   (optional)        |                           |                                |                               |
+---------+---------------------+---------------------------+--------------------------------+-------------------------------+
|   5     | SINGLE BANK FOTA    | 0x3d000                   |                                | About 40KB                    |
|         | UTILITY (optional)  |                           |                                |                               |
+---------+---------------------+---------------------------+--------------------------------+-------------------------------+
|   4     | IMAGE and OTA IMAGE | 0x5000                    |                                |                               |
+---------+---------------------+---------------------------+--------------------------------+-------------------------------+
|   3     | PERSISTENT DATA     | 0x2000                    | 0x5000                         | SECTION_NUM * SECTION_SIZE    |
|         |                     |                           |                                | ( Default 12KB)               |
+---------+---------------------+---------------------------+--------------------------------+-------------------------------+
|   2     | SECOND BOOTLOADER   | 0x1000                    | 0x2000                         | 4KB                           |
+---------+---------------------+---------------------------+--------------------------------+-------------------------------+
|   1     | INFORMATION         | 0x0                       | 0x1000                         | 4KB                           |
+---------+---------------------+---------------------------+--------------------------------+-------------------------------+

**INFORMATION**
    运行时，为只读区域。需应用程序确保不写此区域。
    
    该区域 0x30-0x35 6个字节默认用于存储设备默认蓝牙地址(Default MAC Address)。
    
    在天猫MESH应用里，该区域 0x200 - 0x219 26个字节默认用于存储三元组。

SRAM
-------

+---------------------+------------------------+---------------+---------------+
| Runtime Section     | Start Address          | End Address   | Size          |
+=====================+========================+===============+===============+
| BLE PROTOCOL DATA   | Stack_Top              | 0xC000        |               |
+---------------------+------------------------+---------------+---------------+
| APP STACK           |                        | Stack_Top     |               |
+---------------------+------------------------+---------------+---------------+
| APP HEAP            |                        |               |               |
+---------------------+------------------------+---------------+---------------+
| APP BSS             |                        |               |               |
+---------------------+------------------------+---------------+---------------+
| APP DATA            |                        |               |               |
+---------------------+                        |               |               |
| APP XIP_BANNED      |                        | __data_end__  |               |
+---------------------+------------------------+---------------+---------------+
| RESET_RETAIN        | 0xC0                   |               |               |
+---------------------+------------------------+---------------+---------------+
| APP ISR_VECTOR      | 0x0                    | 0xC0          |               |
+---------------------+------------------------+---------------+---------------+